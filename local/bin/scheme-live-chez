#!/bin/bash

set -e

HELP_MAIN="usage: scheme-live chez <sub-commands> [options]"


scheme-live-chez-install () {
    echo Installed via debian
    # PREFIX=$1

    # if [ "x$PREFIX" == "x" ]; then
    #     PREFIX=$SCHEME_LIVE_PREFIX
    # fi

    # if test -f "$PREFIX/bin/scheme"; then
    #     echo "chez is already installed at $PREFIX"
    #     exit 1
    # fi

    # WORK=$PREFIX/tmp/chez-scheme-$(date --iso=seconds)
    # echo "Work directory is: $WORK"
    # mkdir -p $WORK
    # wget "https://github.com/cisco/ChezScheme/archive/refs/tags/v9.5.6.tar.gz" --output-document="$WORK/scheme.tar.gz"
    # tar -xvf "$WORK/scheme.tar.gz" --directory="$WORK"
    # cd $WORK/ChezScheme*/
    # ./configure --threads --disable-x11 --disable-curses --installprefix=$PREFIX
    # make install
}

scheme-live-chez-run () {
    SOURCE=$(mktemp --tmpdir=$SCHEME_LIVE_PREFIX/tmp/ $(basename $1).XXXXXX.scm)
    echo "(import (only (chezscheme) import))" >> $SOURCE
    tail -n +2 $1 >> $SOURCE
    shift
    scheme --libexts .chez.sls:.sls --libdirs $SCHEME_LIVE_PREFIX/lib/ --program $SOURCE $@
}

scheme-live-chez-repl () {
    rlwrap scheme --libexts .chez.sls:.sls --libdirs $SCHEME_LIVE_PREFIX/lib/
}

scheme-live-chez-version () {
    # TODO: Use Version flag @ https://srfi.schemers.org/srfi-176/
    scheme --version
}

scheme-live-chez-check () {
    SCHEME_LIVE_CURRENT=chez scheme-live current check
}

source $SCHEME_LIVE_PREFIX/shell-subcommand.sh
